<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Enterprise E-Commerce Store</title>

<style>
/* ---------------- ðŸŽ¨ UI/UX IMPROVEMENTS ---------------- */
:root {
  --primary: #1f2937; /* Darker primary */
  --accent: #10b981; /* Green accent (modern/enterprise look) */
  --bg: #f9fafb;
  --card: #ffffff;
  --shadow: 0 5px 20px rgba(0, 0, 0, 0.08);
}

* { box-sizing: border-box; font-family: 'Inter', system-ui; transition: all 0.3s ease-out; }
body { margin: 0; background: var(--bg); color: var(--primary); }

header {
  display: flex;
  align-items: center;
  justify-content: space-between;
  padding: 15px 25px;
  background: var(--card);
  box-shadow: var(--shadow);
  position: sticky;
  top: 0;
  z-index: 10;
}

header strong { font-size: 1.5rem; color: var(--accent); }

header input {
  width: 40%;
  padding: 10px;
  border-radius: 8px;
  border: 1px solid #ddd;
  transition: border-color 0.2s;
}
header input:focus { border-color: var(--accent); outline: none; }

button {
  padding: 10px 15px;
  border: none;
  border-radius: 8px;
  background: var(--accent);
  color: #fff;
  cursor: pointer;
  font-weight: 600;
  transition: background 0.2s, transform 0.1s;
}
button:hover { background: #059669; }
button:active { transform: scale(0.98); }

/* ---------------- GRID & PRODUCT ---------------- */
#productGrid {
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
  gap: 30px;
  padding: 30px;
}

.product {
  background: var(--card);
  border-radius: 12px;
  box-shadow: 0 4px 12px rgba(0, 0, 0, 0.05);
  padding: 20px;
  display: flex;
  flex-direction: column;
  transition: transform 0.3s, box-shadow 0.3s;
}
.product:hover {
  transform: translateY(-8px);
  box-shadow: var(--shadow);
}

.product img {
  width: 100%;
  height: 200px;
  object-fit: cover;
  border-radius: 8px;
  margin-bottom: 15px;
}

.tags {
  font-size: 12px;
  color: #6b7280;
  margin-top: 5px;
}

/* ---------------- MODALS & CART ---------------- */
.modal {
  position: fixed;
  inset: 0;
  background: rgba(0, 0, 0, 0.6);
  display: none;
  justify-content: center;
  align-items: center;
  opacity: 0;
  pointer-events: none;
  transition: opacity 0.3s ease;
}
.modal.open {
  display: flex;
  opacity: 1;
  pointer-events: auto;
}

.modal-content {
  background: var(--card);
  padding: 30px;
  width: 90%;
  max-width: 550px;
  border-radius: 12px;
  max-height: 90vh;
  overflow: auto;
  transform: translateY(-50px);
  transition: transform 0.3s ease, opacity 0.3s ease;
}
.modal.open .modal-content {
  transform: translateY(0);
}

.cart-item {
  display: flex;
  justify-content: space-between;
  align-items: center;
  margin: 15px 0;
  padding-bottom: 10px;
  border-bottom: 1px dashed #eee;
}

.quantity-control {
  display: flex;
  align-items: center;
  gap: 10px;
}
.quantity-control button {
  padding: 5px 10px;
  background: #e5e7eb;
  color: var(--primary);
  font-weight: bold;
}
.quantity-control button:hover { background: #d1d5db; }
.quantity-control span { min-width: 20px; text-align: center; }

input, textarea, select {
  width: 100%;
  padding: 10px;
  margin: 8px 0;
  border: 1px solid #ccc;
  border-radius: 6px;
  font-size: 1rem;
}

.button-group {
  display: flex;
  gap: 10px;
  margin-top: 20px;
}

/* ---------------- PAGES ---------------- */
.page-view {
  display: none;
}
.page-view.active {
  display: block;
}

/* ---------------- ADMIN TABLE STYLES ---------------- */
#adminPanel {
  padding: 30px;
}
#adminPanel h3 { border-bottom: 2px solid var(--accent); padding-bottom: 10px; }

.product-table {
  width: 100%;
  border-collapse: collapse;
  margin-top: 20px;
  box-shadow: 0 2px 8px rgba(0,0,0,0.05);
  background: white;
  border-radius: 8px;
  overflow: hidden;
}
.product-table th, .product-table td {
  padding: 12px 15px;
  text-align: left;
  border-bottom: 1px solid #f3f4f6;
}
.product-table th {
  background-color: #e5e7eb;
  color: var(--primary);
  font-weight: 600;
  text-transform: uppercase;
  font-size: 0.85rem;
}
.product-table tr:hover {
  background-color: #f9fafb;
}
.product-table button {
  padding: 6px 10px;
  font-size: 0.9rem;
}

/* ---------------- CHECKOUT REVIEW (NEW) ---------------- */
#orderReview {
    margin-bottom: 20px;
    padding: 15px;
    border: 1px solid #ddd;
    border-radius: 8px;
    background: #fcfcfc;
}
.review-item {
    display: flex;
    justify-content: space-between;
    font-size: 0.95rem;
    padding: 5px 0;
}
.review-total {
    font-weight: bold;
    border-top: 1px solid #eee;
    padding-top: 10px;
    margin-top: 10px;
}
</style>
</head>

<body>

<header>
  <nav>
    <a href="#store" style="text-decoration: none;">
      <strong>Premium Store</strong>
    </a>
  </nav>
  <input id="search" placeholder="Search by name or #tag">
  <div>
    <button onclick="changePage('admin')">Admin</button>
    <button onclick="changePage('store')">Store</button>
    <button onclick="openCart()">Cart (<span id="cartCount">0</span>)</button>
  </div>
</header>

<main id="appContainer">

  <div id="storeView" class="page-view active">
    <div id="productGrid"></div>
  </div>

  <div id="adminView" class="page-view">
    <div id="adminPanel">
      <h2>Admin Panel: Product Management</h2>
      <p>Use this panel to dynamically add and manage your products.</p>
      
      <h3>Add New Product</h3>
      <form id="productForm">
        <input required placeholder="Product Name" id="pName">
        <input required placeholder="Price (à§³)" id="pPrice" type="number" min="1">
        <input required placeholder="Tags (e.g. #audio #wireless)" id="pTags">
        <input required placeholder="Image URL (e.g. https://picsum.photos/300/200)" id="pImg">
        <button type="submit">Add Product</button>
      </form>

      <h3 style="margin-top: 30px;">Current Products List</h3>
      <div id="adminProductList">
        </div>
    </div>
  </div>

</main>

<div class="modal" id="cartModal">
  <div class="modal-content">
    <h3>Your Cart</h3>
    <div id="cartItems"></div>
    <p><strong>Total: à§³<span id="total">0</span></strong></p>
    <div class="button-group">
      <button onclick="openCheckout()">Checkout</button>
      <button onclick="closeCart()" style="background: #ef4444;">Close</button>
    </div>
  </div>
</div>

<div class="modal" id="checkoutModal">
  <div class="modal-content">
    <h3>Final Checkout</h3>
    
    <div id="orderReview">
        <h4>Order Summary</h4>
        <div id="reviewItems"></div>
        <div class="review-total">Total Amount: à§³<span id="reviewTotal">0</span></div>
    </div>

    <form id="checkoutForm">
      <h4>Shipping and Payment</h4>
      <input required placeholder="Full Name" id="name">
      <input required placeholder="Primary Phone" id="phone1">
      <textarea required placeholder="Address" id="address"></textarea>

      <select id="payment" required>
        <option value="">Select Payment Method</option>
        <option value="bkash">bKash (Simulated API)</option>
        <option value="rocket">Rocket (Simulated API)</option>
        <option value="cod">Cash on Delivery</option>
      </select>

      <div class="button-group">
        <button type="submit">Confirm Order</button>
        <button type="button" onclick="closeCheckout()" style="background: #9ca3af;">Cancel</button>
      </div>
    </form>
  </div>
</div>

<script>
/* ---------------- STATE MANAGEMENT (Local Storage) ---------------- */
const INITIAL_PRODUCTS = [
  {id:1,name:"Wireless Headphone X",price:3500,tags:["#audio","#wireless"],img:"https://picsum.photos/300/200?v=1"},
  {id:2,name:"Smart Watch Pro",price:2800,tags:["#watch","#smart"],img:"https://picsum.photos/300/200?v=2"},
  {id:3,name:"Bluetooth Speaker Mini",price:2200,tags:["#audio","#speaker"],img:"https://picsum.photos/300/200?v=3"}
];

function getProducts() {
  const stored = localStorage.getItem("products");
  if (!stored) {
    localStorage.setItem("products", JSON.stringify(INITIAL_PRODUCTS));
    return INITIAL_PRODUCTS;
  }
  return JSON.parse(stored);
}

let products = getProducts();
let cart = JSON.parse(localStorage.getItem("cart")) || [];

function saveProducts() {
  localStorage.setItem("products", JSON.stringify(products));
  renderAdminProducts();
  renderProducts(products);
}

function saveCart() {
  cart = cart.filter(item => item.quantity > 0);
  localStorage.setItem("cart", JSON.stringify(cart));
  document.getElementById("cartCount").innerText = cart.length;
}

/* ---------------- CART ACTIONS & RENDER ---------------- */
function addToCart(productId) {
  const id = parseInt(productId);
  const existingItem = cart.find(item => item.id === id);
  const product = products.find(p => p.id === id);
  
  if (!product) return;

  if (existingItem) {
    existingItem.quantity += 1;
  } else {
    cart.push({ ...product, quantity: 1 });
  }
  saveCart();
  openCart();
}

function updateQuantity(id, delta) {
  const item = cart.find(item => item.id === id);
  if (item) {
    item.quantity += delta;
    if (item.quantity < 1) item.quantity = 0; 
  }
  saveCart();
  openCart();
}

function renderProducts(list) {
  const grid = document.getElementById("productGrid");
  grid.innerHTML = "";
  
  if (list.length === 0) {
    grid.innerHTML = `<p style="grid-column: 1 / -1; text-align: center; padding: 50px;">
      No products found matching your search or in stock.
    </p>`;
    return;
  }
  
  list.forEach(p => {
    grid.innerHTML += `
      <div class="product">
        <img src="${p.img}" alt="${p.name}">
        <h4>${p.name}</h4>
        <p style="font-size: 1.2rem; font-weight: bold; color: #374151;">à§³${p.price}</p>
        <p class="tags">${p.tags.join(" ")}</p>
        <button style="margin-top: auto;" onclick='addToCart(${p.id})'>
          Add to Cart
        </button>
      </div>`;
  });
}

function renderAdminProducts() {
  const adminList = document.getElementById("adminProductList");
  
  if (products.length === 0) {
    adminList.innerHTML = "<p style='text-align: center; padding: 20px; color: #6b7280;'>No products in the database. Start adding some!</p>";
    return;
  }

  let tableHTML = `
    <table class="product-table">
      <thead>
        <tr>
          <th>ID</th>
          <th>Name</th>
          <th>Price</th>
          <th>Tags</th>
          <th>Actions</th>
        </tr>
      </thead>
      <tbody>
  `;

  products.forEach(p => {
    tableHTML += `
      <tr>
        <td>${p.id}</td>
        <td>${p.name}</td>
        <td>à§³${p.price}</td>
        <td>${p.tags.join(", ")}</td>
        <td>
          <button style="background: #ef4444;" onclick='deleteProduct(${p.id})'>Delete</button>
        </td>
      </tr>
    `;
  });

  tableHTML += `</tbody></table>`;
  adminList.innerHTML = tableHTML;
}

/* ---------------- MODALS & UI ---------------- */
function openCart() {
  const modal = document.getElementById("cartModal");
  modal.classList.add("open");
  const items = document.getElementById("cartItems");
  let total = 0;
  items.innerHTML = "";
  
  if (cart.length === 0) {
    items.innerHTML = "<p style='text-align: center; color: #6b7280;'>Your cart is empty.</p>";
    document.getElementById("total").innerText = 0;
    return;
  }
  
  cart.forEach(c => {
    const itemTotal = c.price * c.quantity;
    total += itemTotal;
    items.innerHTML += `
      <div class="cart-item">
        <span style="flex: 2;">${c.name}</span>
        <div class="quantity-control">
          <button onclick="updateQuantity(${c.id}, -1)">-</button>
          <span>${c.quantity}</span>
          <button onclick="updateQuantity(${c.id}, 1)">+</button>
        </div>
        <span style="flex: 1; text-align: right;">à§³${itemTotal}</span>
      </div>
    `;
  });
  document.getElementById("total").innerText = total;
}

function closeCart() { document.getElementById("cartModal").classList.remove("open"); }

// NEW: Function to render order summary in checkout modal
function renderOrderSummary() {
    const reviewItems = document.getElementById('reviewItems');
    const reviewTotal = document.getElementById('reviewTotal');
    let total = 0;

    reviewItems.innerHTML = '';

    cart.forEach(c => {
        const itemTotal = c.price * c.quantity;
        total += itemTotal;
        reviewItems.innerHTML += `
            <div class="review-item">
                <span>${c.name} (${c.quantity} x à§³${c.price})</span>
                <span>à§³${itemTotal}</span>
            </div>
        `;
    });
    reviewTotal.innerText = total;
}


function openCheckout() {
  if (cart.length === 0) {
     alert("Cart is empty! Cannot proceed to checkout.");
     return;
  }
  closeCart();
  renderOrderSummary(); // Call the new summary function
  document.getElementById("checkoutModal").classList.add("open");
}

function closeCheckout() { document.getElementById("checkoutModal").classList.remove("open"); }


/* ---------------- ROUTING ---------------- */
function changePage(pageId) {
  const views = document.querySelectorAll('.page-view');
  views.forEach(view => view.classList.remove('active'));
  document.getElementById(pageId + 'View').classList.add('active');
  
  if (pageId === 'admin') {
    renderAdminProducts(); 
  }
}

function handleHashChange() {
  const hash = window.location.hash.replace('#', '');
  if (hash === 'admin') {
    changePage('admin');
  } else {
    changePage('store');
  }
}

window.addEventListener('hashchange', handleHashChange);
window.location.hash = window.location.hash || 'store';
handleHashChange();

/* ---------------- ADMIN ACTIONS ---------------- */
document.getElementById("productForm").addEventListener("submit", e => {
  e.preventDefault();
  
  const maxId = products.length > 0 ? Math.max(...products.map(p => p.id)) : 0;

  const newProduct = {
    id: maxId + 1, 
    name: document.getElementById("pName").value,
    price: parseFloat(document.getElementById("pPrice").value) || 0,
    tags: document.getElementById("pTags").value.split(' ').map(t => t.trim()).filter(t => t.startsWith('#')),
    img: document.getElementById("pImg").value
  };
  
  products.push(newProduct);
  saveProducts(); 
  
  document.getElementById("productForm").reset();
  alert(`Product "${newProduct.name}" (ID: ${newProduct.id}) added successfully and is now live in the store!`);
});

function deleteProduct(id) {
  if (confirm("Are you sure you want to delete this product?")) {
    products = products.filter(p => p.id !== id);
    saveProducts();
  }
}

/* ---------------- CHECKOUT SIMULATION (Enhanced) ---------------- */
document.getElementById("checkoutForm").addEventListener("submit", e => {
  e.preventDefault();

  const total = cart.reduce((s, c) => s + (c.price * c.quantity), 0);
  const method = payment.value;
  const customerName = name.value;
  const customerPhone = phone1.value;

  if (cart.length === 0) {
    alert("Your cart is empty! Add products before checking out.");
    return;
  }

  // --- bKash/Rocket API Flow Simulation ---
  if (method === "bkash" || method === "rocket") {
    
    // Step 1: Server (Simulated) initiates payment and gets redirect URL
    alert(`
      --- Step 1: Initiating Payment ---
      Securely sending order details to the server for ${method} integration.
      Order Total: à§³${total}
      Customer: ${customerName}, Phone: ${customerPhone}
    `);

    // Step 2: Client redirects to Payment Gateway
    setTimeout(() => {
        alert(`
          --- Step 2: Payment Gateway Redirect ---
          (Simulated) You are now being securely redirected to the official ${method} payment page.
          You would enter your account number and PIN on the official gateway page here.
        `);
    }, 500); // Simulate a brief server delay

    // Step 3: Payment is successful and server gets callback
    setTimeout(() => {
         alert(`
          --- Step 3: Payment Success (Simulated Callback) ---
          The ${method} API confirms successful payment of à§³${total}.
          Your order is now confirmed and will be processed!
        `);
        // Finalize order after successful payment simulation
        finalizeOrder();
    }, 1500); // Simulate the time needed for the user to complete payment

  } else if (method === "cod") {
    alert(`Order placed! Total à§³${total}. You selected Cash on Delivery (COD). We will call to confirm your order.`);
    finalizeOrder();
  } else {
     alert("Please select a valid payment method.");
     return;
  }
});

function finalizeOrder() {
    cart = [];
    saveCart();
    closeCheckout();
    changePage('store');
}


// Initial load
saveCart();
renderProducts(products); 
</script>

</body>
</html>
